# smplOS Hypridle Configuration
# Manages idle timeouts: screen lock, DPMS, suspend
#
# Flow: lock (5min) -> DPMS off (5.5min) -> suspend (10min)
# On wake: DPMS on + ensure hyprlock is visible
#
# NOTE: DPMS off and suspend are disabled inside VMs (QEMU/KVM/VirtualBox)
# because virtual displays can't handle DPMS wake and VM suspend is
# unrecoverable without ACPI passthrough.

general {
    lock_cmd = pidof hyprlock || hyprlock
    before_sleep_cmd = loginctl lock-session
    after_sleep_cmd = hyprctl dispatch dpms on
}

# 5min -- lock screen (hyprlock shows password dialog)
listener {
    timeout = 300
    on-timeout = loginctl lock-session
}

# 5.5min -- screen off (hyprlock stays running underneath)
listener {
    timeout = 330
    on-timeout = systemd-detect-virt -q || hyprctl dispatch dpms off
    on-resume = hyprctl dispatch dpms on
}

# 10min -- suspend (skip in VMs)
listener {
    timeout = 600
    on-timeout = systemd-detect-virt -q || systemctl suspend
}
