# smplOS Window Rules
# See https://wiki.hyprland.org/Configuring/Window-Rules/ for more

# ============================================================================
# Layer rules (EWW bar + popups)
# ============================================================================

# Frosted glass blur behind the bar
layerrule = blur on, match:namespace eww-bar
layerrule = blur_popups on, match:namespace eww-bar
layerrule = ignore_alpha 0.1, match:namespace eww-bar
layerrule = xray off, match:namespace eww-bar

# Blur behind calendar popup
layerrule = blur on, match:namespace eww-calendar-popup
layerrule = blur_popups on, match:namespace eww-calendar-popup
layerrule = ignore_alpha 0.1, match:namespace eww-calendar-popup
layerrule = xray off, match:namespace eww-calendar-popup

# Blur behind quick settings panel
layerrule = blur on, match:namespace eww-quick-settings
layerrule = blur_popups on, match:namespace eww-quick-settings
layerrule = ignore_alpha 0.1, match:namespace eww-quick-settings
layerrule = xray off, match:namespace eww-quick-settings

# Blur behind notification hub
layerrule = blur on, match:namespace eww-notification-hub
layerrule = blur_popups on, match:namespace eww-notification-hub
layerrule = ignore_alpha 0.1, match:namespace eww-notification-hub
layerrule = xray off, match:namespace eww-notification-hub

# Blur behind USB popup
layerrule = blur on, match:namespace eww-usb-popup
layerrule = blur_popups on, match:namespace eww-usb-popup
layerrule = ignore_alpha 0.1, match:namespace eww-usb-popup
layerrule = xray off, match:namespace eww-usb-popup

# ============================================================================
# Rofi launcher (layer surface on Wayland -- needs layerrule, not windowrule)
# ============================================================================
layerrule = animation slide left, match:namespace rofi
layerrule = order -1, match:namespace rofi
layerrule = blur on, match:namespace rofi
layerrule = blur_popups on, match:namespace rofi
layerrule = ignore_alpha 0.1, match:namespace rofi

# Rofi dialogs (keybind-help, theme-picker use -normal-window for popin animation)
windowrule = float on, match:class ^(rofi)$
windowrule = center on, match:class ^(rofi)$
windowrule = pin on, match:class ^(rofi)$
windowrule = animation popin, match:class ^(rofi)$
windowrule = opacity $themePopupOpacity override $themePopupOpacity override, match:class ^(rofi)$

# ============================================================================
# Window rules
# ============================================================================

# Prevent maximize from apps
windowrule = suppress_event maximize, match:class .*

# ── Opacity model ────────────────────────────────────────────────────────────
#
# Windows fall into one of three opacity classes, expressed as tags:
#
#  (untagged)          — regular apps. Hyprland applies theme active/inactive
#                        opacity. This is the default for everything.
#
#  compositor-opaque   — Hyprland forces 1.0. Used for media players, video
#                        webapps, pip, and fullscreen. Also browsers, where we
#                        still want the theme opacity but via `override` so
#                        focus/unfocus uses the same value.
#
#  self-managed-alpha  — App owns its own alpha channel (st ALPHA_PATCH,
#                        Slint ARGB surfaces). Hyprland must pass 1.0 override
#                        so the two don't compound (e.g. 0.85×0.85≈0.72).
#                        Adding a new Slint app? Tag it self-managed-alpha here.
#                        No other change needed — the opacity rule below covers
#                        all tagged windows automatically.
#
# ── Tag assignment ───────────────────────────────────────────────────────────

# Terminals (st ALPHA_PATCH renders its own semi-transparent background)
windowrule = tag +self-managed-alpha, match:class ^(terminal|st|st-256color|com\.mitchellh\.ghostty)$

# Rust/Slint popup apps (ARGB surface, opacity set in-app via $theme-popup-opacity)
windowrule = tag +self-managed-alpha, match:class ^(start-menu|notif-center|kb-center|disp-center|app-center|webapp-center)$

# Media and special — always fully opaque
windowrule = tag +compositor-opaque, match:class ^(mpv|imv|vlc|zoom|org\.kde\.kdenlive|com\.obsproject\.Studio|com\.github\.PintaProject\.Pinta|org\.gnome\.NautilusPreviewer|steam|qemu)$
windowrule = tag +compositor-opaque, match:tag pip
windowrule = tag +compositor-opaque, match:fullscreen 1

# Video webapps
windowrule = tag +compositor-opaque, match:initial_title ((?i)(?:[a-z0-9-]+\.)*youtube\.com_/|app\.zoom\.us_/wc/home)

# ── Opacity rules (one per class, nothing else sets opacity) ─────────────────

# Default: compositor controls theme opacity for all unclassed windows
windowrule = opacity $themeOpacityActive $themeOpacityInactive, match:class .*

# Browsers: force same value active & inactive (override prevents focus-dim)
windowrule = opacity $themeOpacityActive override $themeOpacityInactive override, match:tag chromium-based-browser
windowrule = opacity $themeOpacityActive override $themeOpacityInactive override, match:tag firefox-based-browser

# compositor-opaque: always fully opaque
windowrule = opacity 1.0 override 1.0 override, match:tag compositor-opaque

# self-managed-alpha: pass through untouched — app owns its ARGB alpha
windowrule = opacity 1.0 override 1.0 override, match:tag self-managed-alpha
windowrule = opaque off, match:tag self-managed-alpha
windowrule = force_rgbx off, match:tag self-managed-alpha

# Fix some dragging issues with XWayland
windowrule = no_focus on, match:class ^$, match:title ^$, match:xwayland 1, match:float 1, match:fullscreen 0, match:pin 0

# ============================================================================
# Application-specific rules
# ============================================================================

# File picker dialogs
windowrule = float on, match:title ^(Open File)(.*)$
windowrule = float on, match:title ^(Save File)(.*)$
windowrule = float on, match:title ^(Select)(.*)$
windowrule = center on, match:title ^(Open File)(.*)$
windowrule = center on, match:title ^(Save File)(.*)$

# Calculator
windowrule = float on, match:class ^(gnome-calculator)$
windowrule = size 400 500, match:class ^(gnome-calculator)$

# Image viewer
windowrule = float on, match:class ^(imv)$
windowrule = center on, match:class ^(imv)$

# Pavucontrol
windowrule = float on, match:class ^(pavucontrol)$
windowrule = size 800 600, match:class ^(pavucontrol)$

# Network Manager
windowrule = float on, match:class ^(nm-connection-editor)$

# Polkit
windowrule = float on, match:class ^(polkit-gnome-authentication-agent-1)$
windowrule = center on, match:class ^(polkit-gnome-authentication-agent-1)$

# Floating terminal windows (theme picker, etc.)
windowrule = float on, match:class ^(floating)$
windowrule = center on, match:class ^(floating)$
windowrule = size 500 600, match:class ^(floating)$


# Start Menu
windowrule = float on, match:class ^(start-menu)$
windowrule = move 2 (monitor_h-window_h-37), match:class ^(start-menu)$
windowrule = pin on, match:class ^(start-menu)$
windowrule = stay_focused on, match:class ^(start-menu)$
windowrule = no_shadow on, match:class ^(start-menu)$
windowrule = animation slide left, match:class ^(start-menu)$

# Notification Center (notif-center)
windowrule = float on, match:class ^(notif-center)$
windowrule = move (monitor_w-window_w-2) (monitor_h-window_h-34), match:class ^(notif-center)$
windowrule = no_shadow on, match:class ^(notif-center)$
windowrule = animation slide, match:class ^(notif-center)$

# Keyboard Center
windowrule = float on, match:class ^(kb-center)$
windowrule = center on, match:class ^(kb-center)$
windowrule = no_shadow on, match:class ^(kb-center)$
windowrule = animation popin, match:class ^(kb-center)$

# Display Center
windowrule = float on, match:class ^(disp-center)$
windowrule = center on, match:class ^(disp-center)$
windowrule = no_shadow on, match:class ^(disp-center)$
windowrule = animation popin, match:class ^(disp-center)$

# ============================================================================
# Messengers -- float + center at a comfortable chat size
# ============================================================================
#
# Opacity model for messengers:
#   - All messengers are tagged +messenger.
#   - $themeMessengerOpacity (set in colors.toml) applies to all of them.
#   - Per-app overrides below let you tune individual apps independently.
#     They come AFTER the tag rule so they win (last matching rule wins).
#     To activate one, uncomment it and set your preferred value.
#
# ── Tag assignment (must come before the opacity rule) ───────────────────────

# Native apps
windowrule = tag +messenger, match:class ^(signal)$
windowrule = tag +messenger, match:class ^(org\.telegram\.desktop|telegramdesktop)$
windowrule = tag +messenger, match:class ^(Slack|slack)$
windowrule = tag +messenger, match:class ^(discord|WebCord|vesktop)$

# Chromium --app webapps (class = "brave-<domain>-Default")
windowrule = tag +messenger, match:class ^(brave-discord)(.*)$
windowrule = tag +messenger, match:class ^(brave-web\.whatsapp)(.*)$
windowrule = tag +messenger, match:class ^(brave-web\.telegram)(.*)$
windowrule = tag +messenger, match:class ^(brave-teams\.microsoft\.com)(.*)$
windowrule = tag +messenger, match:class ^(brave-github\.com)(.*)$

# ── Opacity (theme default for all messengers) ───────────────────────────────
windowrule = opacity $themeMessengerOpacity override $themeMessengerOpacity override, match:tag messenger

# ── Per-app opacity overrides ────────────────────────────────────────────────
# Uncomment and adjust any of these. They override the theme default above.
# windowrule = opacity 0.70 override 0.70 override, match:class ^(signal)$
# windowrule = opacity 0.75 override 0.75 override, match:class ^(org\.telegram\.desktop|telegramdesktop)$
# windowrule = opacity 0.80 override 0.80 override, match:class ^(Slack|slack)$
# windowrule = opacity 0.65 override 0.65 override, match:class ^(discord|WebCord|vesktop)$
# windowrule = opacity 0.80 override 0.80 override, match:class ^(brave-teams\.microsoft\.com)(.*)$
# windowrule = opacity 0.75 override 0.75 override, match:class ^(brave-web\.whatsapp)(.*)$
windowrule = opacity 0.90 override 0.70 override, match:class ^(brave-discord)(.*)$
windowrule = opacity 0.90 override 0.70 override, match:class ^(brave-github\.com)(.*)$

# ── Layout (float + position + size) ────────────────────────────────────────

# Signal Desktop
windowrule = float on, match:class ^(signal)$
windowrule = move (monitor_w-window_w-2) (monitor_h-window_h-34), match:class ^(signal)$
windowrule = size 480 720, match:class ^(signal)$

# Telegram
windowrule = float on, match:class ^(org\.telegram\.desktop|telegramdesktop)$
windowrule = move (monitor_w-window_w-2) (monitor_h-window_h-34), match:class ^(org\.telegram\.desktop|telegramdesktop)$
windowrule = size 480 720, match:class ^(org\.telegram\.desktop|telegramdesktop)$

# Slack
windowrule = float on, match:class ^(Slack|slack)$
windowrule = move (monitor_w-window_w-2) (monitor_h-window_h-34), match:class ^(Slack|slack)$
windowrule = size 480 720, match:class ^(Slack|slack)$

# Discord / Webcord (native app or webapp)
windowrule = float on, match:class ^(discord|WebCord|vesktop)$
windowrule = move (monitor_w-window_w-2) (monitor_h-window_h-34), match:class ^(discord|WebCord|vesktop)$
windowrule = size 480 720, match:class ^(discord|WebCord|vesktop)$

# Chromium --app webapps (Discord, WhatsApp, Teams, etc. via launch-webapp)
# WM class is "brave-<domain>-Default" or "chromium-<domain>-Default"
windowrule = float on, match:class ^(brave-discord)(.*)$
windowrule = move (monitor_w-window_w-2) (monitor_h-window_h-34), match:class ^(brave-discord)(.*)$
windowrule = size 480 720, match:class ^(brave-discord)(.*)$

windowrule = float on, match:class ^(brave-web\.whatsapp)(.*)$
windowrule = move (monitor_w-window_w-2) (monitor_h-window_h-34), match:class ^(brave-web\.whatsapp)(.*)$
windowrule = size 480 720, match:class ^(brave-web\.whatsapp)(.*)$

windowrule = float on, match:class ^(brave-web\.telegram)(.*)$
windowrule = move (monitor_w-window_w-2) (monitor_h-window_h-34), match:class ^(brave-web\.telegram)(.*)$
windowrule = size 480 720, match:class ^(brave-web\.telegram)(.*)$

windowrule = float on, match:class ^(brave-teams\.microsoft\.com)(.*)$
windowrule = move (monitor_w-window_w-2) (monitor_h-window_h-34), match:class ^(brave-teams\.microsoft\.com)(.*)$
windowrule = size 480 720, match:class ^(brave-teams\.microsoft\.com)(.*)$

windowrule = float on, match:class ^(brave-github\.com)(.*)$
windowrule = center on, match:class ^(brave-github\.com)(.*)$
windowrule = size 1200 800, match:class ^(brave-github\.com)(.*)$
